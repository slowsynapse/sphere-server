image: node:10.15.3

pipelines:
  default:
    - step:
        name: Trigger remote build
        image: google/cloud-sdk:latest
        script:
        - echo 'ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAic3BoZXJlLTI3OTIxMiIsCiAgInByaXZhdGVfa2V5X2lkIjogIjNjMDk4YTViN2ExNjljZjRhNTlkM2Y1ZTg3ZDkxMDIzODE3OGI3N2MiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRG8zSERRa29oUWxSNS9cbklMZHlld3RsWlJCL2tmUjRpR3ZZcjVVZ2M5bUNaczdObjhzbXpsUFd3bmpmaUVSYnZpRkQrK09pZ2c1azhMZVhcblZ4WmZwVW1BUHZVeUZRMEZBVFU1bWl2QWYxS3A3WUNiVWxuSkd1ZW9yalJHT1VpbndPZEFWeEhhbFJPNkxRNFdcbnJSUERDbXg0S21tMXJFaU9oSE56TTNsbG1la2IvMjE3UFA4RHFGdWlFRjZnYmJKSndEQTRPTHIyRDNGWlF3VHFcbjBxZlAxemluQTc3SDgrUFNKYXZMbDhLMkNhWXhPTGFHMnNZNDJrSVlkQmVSVW5CRTlpN1BpaWlyMENYNkdsd1NcbndNWnBkSlpqN0FhRE50S1M1N1R5MlNTZDkyelllQk5tT0J4b1E3MnJwckxObmZHYXNpbVpCdFQ4ZXpUWmVkdmhcbkczK0F1V3NOQWdNQkFBRUNnZ0VBRllTSlNEekNLL0FicVZPMG4vZU96Z2ZReG5rT1JqVVZBaWozZHRBOXdUY09cbjFTRjIvRmNFbUV2UUw1ZS8rVnBRYUovV0lTWXpmbEJnSnJQOWRVa295WmtIdjJFQ212dkpsMUVQeWZINkNZblFcbjRJbHprb25SN2x4cXFES1M3QzEvTVFyYXM0QWpHb2tmVENraU1sdThPajV4RmtDZFU4NFpmUU84ckE3VTQ2bEJcbnFpbVN2ZlA0SEVyamlzZ0RWVnRYU3FJek5kam96d0s1L2cxMUpKS2pSbU5ndHlmbGI1aDRZbnBxWkgyQ3crUDlcbklTYXFTSFFJaFVBcTgvOEhBTDZ0YzZkSFIxbUR6RGlnTVNpWXhQTDkxWG1zVDZHeEZIaExselRtZWFDQis1RkFcbkpuYXpHKzRBeTdFUWkwN1JhbTI5WnE4dnJDUHJLZTdPdmlyZFFnZG9ZUUtCZ1FENW9makREUzUvWUROWTBRSGVcbjV1REVWTTVEYXA0Tm1nTkV1dGV2aW5DUlNnQitnMk5PeGJkd3VyVVJvZmNMWnJFU09FOU5iTzdKK1JzQ2EySWpcbjRDbjJoM1EzYTB3N3NqNWRZci9pOUVFNTlXa1B4YjhlK2ZrNk9aeHIzTXRicEpTeVUzNlBib2pJNlhMVmJVNEdcbjlYZVAvaGRudmpYZkZZUWFpeWhoMnJzOGd3S0JnUUR1elBTT0tPczdSaUlFamxkRzBOWVlHeWJzTnJsNmFJYTVcbnVxZjdPcGF1YS9NT2N0NkJ5MEE5VHYzZ3pzQWU5WWZ2MTFpWm94SlJoQmg3Y0plUnVzcnhnUW1rNGNyTW5laFNcbkpFMlN2THcwZ2M3Nlo2ZXhUdEFLZUVsVkRmczNsU1dCTmtneDVRM3lxR3dwUi8yS05sZXd3SjMrMjE4UTNrRWpcbjM0VVFRSzVGTHdLQmdRQ2x6TFowbG1TenBTbDFiQnhaOSs2QmQvSW5STUVGTjYzRUVIVUEybW81bFhVT2tpVjdcblJFYTZVTWZDbGxpRzhnWFpuQnpQeC9JeG80b1U2VTJkbGwxSXFGN0FFRHZweWxFeHBVemRhRzJLR1QxV2hIaVVcbkVtTStFTldicm1KQzArVVBLL1Y3UG1jTFNrSkREdjRzRVEwQVRqc3RaR0JUY3U3eTBrcFg4L2M0RVFLQmdDVXNcbmJwMTZyVE9xOVR5MFU4M0lVS3VyL21Fakc3aDhjUXlVaS9YRjV4TDc1dmhHMVhCckRYTDl5dk9sKzY1V0ZuVTFcbmxxdEVBV1FESmpTQkVIYzFGc2FGaWRUSytXRGs2L2R0ZzAzbVozM2MvelZuMFdqK2xkQXJiVzc2SURORTJuUEVcbjJYUTY3ZkxxV1B3TUl1SFRGOCtDREpaUjIvaXFRSVd2RSsyMXcrc3RBb0dCQU5NU2tQMmNRY3NoV2tCNFFva3lcbmFDTWFlWmhxNTY4SXliaWFhY0FEYVVWSWUxSkVjZUVFR3UxZFZlQTY3alhVMTVBWnIwaTBpR1pKVVJQU1VDK2lcbkFSdS9aNEMxdjRwMnRhalJ1S3VXYm9ZdjNEK0FFUm9aS3EvVmpIenVxY3I2WlpnczdoT1hUQllOV09KM1NFY3VcbmdWQm8vZnAzUTNCNkFsaSsxeDY3QXNRQlxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogIjEwMTk1MTYzOTgzNzEtY29tcHV0ZUBkZXZlbG9wZXIuZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMDMzMzY5OTIyNDUzODY5NTUyMjIiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5LzEwMTk1MTYzOTgzNzEtY29tcHV0ZSU0MGRldmVsb3Blci5nc2VydmljZWFjY291bnQuY29tIgp9Cg==' | base64 -d >> /tmp/key-file.json
        - gcloud auth activate-service-account --key-file /tmp/key-file.json --quiet ${gcloud_debug_args}
        - gcloud projects list
        - gcloud config set project sphere-279212 --quiet ${gcloud_debug_args}

            # deploy to cloud run
        - gcloud compute ssh sphere-server-staging --zone=asia-east1-b --command 'cd sphere-server'

        - echo "May the force be with you."
